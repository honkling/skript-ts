"use strict";var skriptWeb=(()=>{var X=Object.defineProperty;var at=Object.getOwnPropertyDescriptor;var pt=Object.getOwnPropertyNames;var ct=Object.prototype.hasOwnProperty;var i=(o,t)=>X(o,"name",{value:t,configurable:!0});var lt=(o,t)=>{for(var e in t)X(o,e,{get:t[e],enumerable:!0})},ut=(o,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of pt(t))!ct.call(o,r)&&r!==e&&X(o,r,{get:()=>t[r],enumerable:!(n=at(t,r))||n.enumerable});return o};var mt=o=>ut(X({},"__esModule",{value:!0}),o);var ht={};lt(ht,{Block:()=>L,BlockContainer:()=>S,BooleanExpression:()=>O,ChangeMode:()=>B,ChoiceElement:()=>d,CoreExtension:()=>nt,Effect:()=>g,Expression:()=>l,ExpressionElement:()=>b,ExtensionRegistry:()=>v,GroupElement:()=>E,Integer:()=>C,IntegerExpression:()=>z,LiteralElement:()=>T,Location:()=>D,LocationProxyLogger:()=>K,LogEntry:()=>Y,LogLevel:()=>ot,MatchPatternResult:()=>u,ModifyEffect:()=>q,NumberExpression:()=>j,Pattern:()=>F,PatternElement:()=>tt,PrintEffect:()=>H,RegexElement:()=>$,Result:()=>y,Script:()=>V,ScriptLoadStructure:()=>Q,Section:()=>I,SectionAction:()=>st,SimpleLogger:()=>rt,Skript:()=>Z,SkriptExtension:()=>U,SkriptParser:()=>et,StringExpression:()=>N,Structure:()=>M,SyntaxElement:()=>f,SyntaxRegistration:()=>h,SyntaxRegistry:()=>G,SyntaxType:()=>x,TestExpression:()=>J,Type:()=>P,Types:()=>R,VariableExpression:()=>A,VariableMap:()=>_,haltCharacters:()=>W});var v=class{constructor(t){this.skript=t}static{i(this,"ExtensionRegistry")}extensions=new Map;registerExtension(t){let e=new t(this.skript);this.extensions.set(t,e),e.initialize()}getExtension(t){return this.extensions.get(t)}getExtensions(){return Array.from(this.extensions.values())}};var P=class{constructor(t,e){this.type=t;this.ids=e}static{i(this,"Type")}toString=this.defaultToString;change=this.defaultChange;acceptChange=this.defaultAcceptChange;setToString(t){return this.toString=t,this}setChange(t){return this.change=t,this}setAcceptChange(t){return this.acceptChange=t,this}defaultToString(t){return t.toString()}defaultChange(t,e,n,r){}defaultAcceptChange(t,e,n){return!1}};var R=class{static{i(this,"Types")}types=new Map;idMap=new Map;registerType(t,...e){let n=new P(t,e);this.idMap.set(t,e[0]);for(let r of e){if(this.types.has(r))throw new Error(`There is already a registered type with id '${r}'`);this.types.set(r,n)}return n}getType(t){if(t instanceof Function){let e=this.idMap.get(t);if(!e)throw new Error(`Type with class '${t.name}' doesn't exist.`);return this.types.get(e)}if(!this.types.has(t))throw new Error(`Type '${t}' is not registered.`);return this.types.get(t)}findTypeFromValue(t){try{return this.getType(t)}catch{for(let[n,r]of this.idMap.entries())if(t instanceof n&&n!==Object)return this.types.get(r);throw new Error(`There is no type for class '${t.constructor.name}'`)}}};var Z=class{static{i(this,"Skript")}extensions=new v(this);types=new R;getSyntaxOfType(t){return this.extensions.getExtensions().map(e=>e.syntaxRegistry.getSyntaxOfType(t)).flat()}};var _=class{static{i(this,"VariableMap")}internalMap=new Map;set(t,e){}};var B=(r=>(r[r.Set=0]="Set",r[r.Add=1]="Add",r[r.Subtract=2]="Subtract",r[r.Delete=3]="Delete",r))(B||{});var f=class{constructor(t){this.skript=t}static{i(this,"SyntaxElement")}},x=(s=>(s[s.Structure=0]="Structure",s[s.Event=1]="Event",s[s.Effect=2]="Effect",s[s.Expression=3]="Expression",s[s.Condition=4]="Condition",s[s.Section=5]="Section",s))(x||{});var S=class extends f{static{i(this,"BlockContainer")}structure=null;block=null;trigger(){this.block.evaluate(this)}};var M=class extends S{static{i(this,"Structure")}symbols=new Map;constructor(t){super(t),this.structure=this,this.preLoad()}preLoad(){}postLoad(){}getSyntaxType(){return 0}};var I=class extends S{constructor(e,n){super(n);this.parent=e;this.structure=e.structure}static{i(this,"Section")}walk(e){}getSyntaxType(){return 5}},st=(e=>(e[e.Execute=0]="Execute",e[e.Skip=1]="Skip",e))(st||{});var l=class extends f{static{i(this,"Expression")}change(t,e,n){let r=this.get(e),a=e.skript.types.findTypeFromValue(r[0]);console.log("Type:",a),a.change(this.isSingle()?r[0]:r,t,e,n)}acceptChange(t,e,n){return!0}getSyntaxType(){return 3}};var g=class extends f{static{i(this,"Effect")}getSyntaxType(){return 2}};var L=class{constructor(t){this.statements=t}static{i(this,"Block")}evaluate(t){for(let e of this.statements){if(e instanceof g){e.execute(t);continue}e.block.evaluate(t)}}};var d=class o{constructor(t,e){this.element=t;this.isOptional=e}static{i(this,"ChoiceElement")}createPattern(t,{skript:e,isOptional:n}){let[r,a]=[["(",")"],["[","]"]][+n],s=0;if(t[s++]!==r)throw new Error(`Expected '${r}'`);let p=[];for(;t[s]!==a;){let[c,m]=E.prototype.createPattern(t.substring(s),{skript:e,patternNumber:-1});p.push(c),s+=m,t[s]==="|"&&s++}if(t[s++]!==a)throw new Error(`Expected '${a}'`);return[new o(p,n),s]}matchPattern(t,{skript:e}){for(let n of this.element){let r=n.matchPattern(t,{skript:e,patternNumber:-1});if(r)return r}return null}};var u=class{constructor(t,e=[],n=[],r=-1){this.size=t;this.regexes=e;this.expressions=n;this.patternNumber=r}static{i(this,"MatchPatternResult")}},tt=class{static{i(this,"PatternElement")}},W=["(",")","[","]","<","%","|"];var O=class extends l{constructor(e,n){super(n);this.value=e}static{i(this,"BooleanExpression")}getReturnType(){return Boolean}isSingle(){return!0}get(){return[this.value]}toString(e){return this.value.toString()}};var C=class extends Number{static{i(this,"Integer")}},z=class extends l{constructor(e,n){super(n);this.value=e}static{i(this,"IntegerExpression")}getReturnType(){return C}isSingle(){return!0}get(){return[this.value]}toString(e){return this.value.toString()}};var j=class extends l{constructor(e,n){super(n);this.value=e}static{i(this,"NumberExpression")}getReturnType(){return Number}isSingle(){return!0}get(){return[this.value]}toString(e){return this.value.toString()}};var N=class extends l{constructor(e,n){super(n);this.value=e}static{i(this,"StringExpression")}getReturnType(){return String}isSingle(){return!0}get(){return[this.value]}toString(e){return this.value}};var A=class extends l{constructor(e,n){super(n);this.name=e}static{i(this,"VariableExpression")}cachedName=null;getReturnType(){return Object}isSingle(){return!0}get(e){let n=this.getName(e);return e.structure.symbols.get(n)}change(e,n,r){let{symbols:a}=n.structure,s=this.getName(n);switch(e){case 0:{a.set(s,r.get(n));break}case 1:case 2:{let p=a.get(s),c=r.get(n);if(console.log({name:s}),!s.endsWith("::*")){let w=a.get(s),k=n.skript.types.getType(p.constructor);console.log({type:k}),k.change(w,e,n,r);return}let m=e===1?p.push:(...w)=>{for(let k of w){let it=p.indexOf(k);it!==-1&&p.splice(it,1)}};Array.isArray(c)?m(...c.flat()):m(c);break}case 3:{a.delete(s);break}}}acceptChange(e,n,r){let a=this.getName(n),s=n.structure.symbols.get(a);return!((e===1||e===2)&&!Array.isArray(s))}toString(e){let n=e.structure.symbols.get(this.name);return this.skript.types.getType(n.constructor).toString(n)}getName(e){return this.cachedName?this.cachedName:this.cachedName=this.evaluateName(e)}evaluateName(e){let n=this.skript.types.getType(Object),r=0,a="";for(;r<this.name.length;){let s=this.name[r++];if(s==="%"){if(this.name[r]==="%"){a+="%",r++;continue}let c=new b(n).matchPattern(this.name.substring(r),{skript:this.skript});if(a+=c.expressions[0].toString(e),this.name[r++]!=="%")throw new Error("Expected '%'");continue}a+=s}return a}};var b=class o{constructor(t){this.type=t}static{i(this,"ExpressionElement")}createPattern(t,{skript:e}){let n="",r=0;if(t[r++]!=="%")throw new Error("Expected '%'");for(;r<t.length&&t[r]!=="%";)n+=t[r++];if(t[r++]!=="%")throw new Error("Expected '%'");return[new o(e.types.getType(n)),r]}matchPattern(t,{skript:e}){let n=e.getSyntaxOfType(3),r=0,a=i(s=>s>="0"&&s<="9","isDigit");switch(!0){case t[r]==='"':{if(this.type.type!==String&&this.type.type!==Object)break;r++;let s="";for(;r<t.length&&t[r]!=='"';){if(t[r]==="\\"){r++,s+=t[r++];continue}s+=t[r++]}if(t[r++]!=='"')break;return new u(r,[],[new N(s,e)])}case a(t[r]):{if(!a(t[r]))break;let s=0,p=0;for(;r<t.length&&a(t[r])||s===0&&t[r]===".";){if(s===0){if(t[r]==="."){s=.1;continue}p*=10,p+=t.charCodeAt(r++)-48;continue}p+=(t.charCodeAt(r++)-48)*s,s/=10}let c=s===0&&(this.type.type===C||this.type.type===Object)?new z(p,e):new j(p,e);return new u(r,[],[c])}case(t.startsWith("true")||t.startsWith("false")):{if(this.type.type!==Boolean&&this.type.type!==Object)break;let s=t.startsWith("true");if(r+=s?4:5,r<t.length&&t[r]>="a"&&t[r]<="z"||a(t[r]))break;return new u(r,[],[new O(s,e)])}}if(t[r]==="{"){let s=e.types.getType(Object),p=new o(s),c="";for(r++;r<t.length&&t[r]!=="}"&&t[r]!==`
`;){let m=t[r++];if(m==="%"){if(t[r]==="%"){c+="%",r++;continue}let w=p.matchPattern(t.substring(r),{skript:e});if(!w)return null;for(let k=0;k<w.size;k++)c+=t[r++];if(t[r++]!=="%")return null;continue}c+=m}return t[r++]!=="}"?null:new u(r,[],[new A(c,e)])}for(let s of n){let p=s.syntaxElement();if(this.type.type!==Object&&p.prototype.getReturnType()!==this.type.type)continue;let c=s.matchPattern(t,{skript:e});if(c)return new u(c.size,[],[s.initialize(e,c)])}return null}};var T=class o{constructor(t){this.value=t}static{i(this,"LiteralElement")}createPattern(t){let e="",n=0;for(;n<t.length&&!W.includes(t[n]);)e+=t[n++];return[new o(e.trim()),n]}matchPattern(t){return t.startsWith(this.value)?new u(this.value.length,[]):null}};var $=class o{constructor(t){this.regex=t}static{i(this,"RegexElement")}createPattern(t){let e="^",n=0;if(t[n++]!=="<")throw new Error("Expected '<'");for(;n<t.length&&t[n]!==">";){let r=t[n++];if(r==="\\"&&t[n]===">"){e+=">",n++;continue}e+=r}if(t[n++]!==">")throw new Error("Expected '>'");return[new o(new RegExp(e,"g")),n]}matchPattern(t){let e=t.match(this.regex);return e?new u(e[0].length,[e[0]]):null}};var E=class o{constructor(t){this.elements=t}static{i(this,"GroupElement")}createPattern(t,{skript:e}){let n=[],r=0;t:for(;r<t.length;){let a=t.substring(r),s=a[0];if(a.startsWith(" ")){r++;continue}switch(s){case"%":{let[p,c]=b.prototype.createPattern(a,{skript:e});n.push(p),r+=c;break}case"(":{let[p,c]=d.prototype.createPattern(a,{skript:e,isOptional:!1});n.push(p),r+=c;break}case"[":{let[p,c]=d.prototype.createPattern(a,{skript:e,isOptional:!0});n.push(p),r+=c;break}case"<":{let[p,c]=$.prototype.createPattern(a);n.push(p),r+=c;break}default:{if(W.includes(s))break t;let[p,c]=T.prototype.createPattern(a);n.push(p),r+=c;break}}}return[new o(n),r]}matchPattern(t,{skript:e,patternNumber:n=-1}){let r=[],a=[],s=0,p;for(let c of this.elements){let m=t.substring(s);switch(!0){case c instanceof b:{p=c.matchPattern(m,{skript:e});break}case c instanceof d:{p=c.matchPattern(m,{skript:e,isOptional:c.isOptional});break}default:{p=c.matchPattern(m,{});break}}if(!p){if(c instanceof d&&c.isOptional)continue;return null}for(c instanceof b?r.push(...p.expressions):a.push(...p.regexes),s+=p.size;t.substring(s).startsWith(" ");)s++}return new u(s,a,r,n)}getKeywords(){return this.elements.filter(t=>t instanceof T).map(t=>t.value)}};var F=class{constructor(t,e){this.pattern=e;this.compiledPattern=E.prototype.createPattern(this.pattern,{skript:t,patternNumber:-1})[0]}static{i(this,"Pattern")}compiledPattern};var G=class{static{i(this,"SyntaxRegistry")}syntax=new Map;registerSyntaxElement(t){let e=t.syntaxElement().prototype.getSyntaxType();this.syntax.has(e)||this.syntax.set(e,[]),this.syntax.get(e).push(t)}getSyntaxOfType(t){return this.syntax.get(t)??[]}},h=class{static{i(this,"SyntaxRegistration")}patterns;constructor(t){this.patterns=this.rawPatterns().map(e=>new F(t,e))}matchPattern(t,{skript:e}){for(let[n,{compiledPattern:r}]of Object.entries(this.patterns)){if(r.getKeywords().find(s=>!t.includes(s)))continue;let a=r.matchPattern(t,{skript:e,patternNumber:parseInt(n)});if(a)return a}return null}};var V=class{constructor(t){this.structures=t}static{i(this,"Script")}};var y=class o{constructor(t,e){this.value=t;this.error=e}static{i(this,"Result")}static success(t){return new o(t,null)}static failure(t){return new o(null,t)}isSuccess(){return this.value!==null&&this.error===null}isFailure(){return this.value===null&&this.error!==null}getValue(){if(this.value===null)throw new Error("Result doesn't have a value");return this.value}getError(){if(this.error===null)throw new Error("Error doesn't have a value");return this.error}};var D=class{constructor(t){this.input=t}static{i(this,"Location")}index=0;line=0;column=1;snapStack=[];advance(t=1){for(let e=0;e<t;e++){let n=this.input[this.index++];this.column++,n===`
`&&(this.line++,this.column=1)}return this}advanceLine(){for(;this.hasInput()&&this.input[this.index++]!==`
`;);return this.line++,this.column=1,this}peek(){return this.input[this.index]}peekLine(){let t=this.input.substring(this.index);return t.substring(0,t.indexOf(`
`))}peekInput(){return this.input.substring(this.index)}hasInput(){return this.input.substring(this.index).trim()!==""}pushSnap(){this.snapStack.push([this.index,this.line,this.column])}popSnap(){this.snapStack.pop()}snap(){let[t,e,n]=this.snapStack.pop();this.index=t,this.line=e,this.column=n}};var K=class{constructor(t,e){this.endpoint=t;this.location=e;this.entries=t.entries}static{i(this,"LocationProxyLogger")}entries;hasError=!1;log(t,e){this.endpoint.log(t,e),this.hasError=this.endpoint.hasError}info(t){this.endpoint.info(this.attachLocation(t)),this.hasError=this.endpoint.hasError}warn(t){this.endpoint.warn(this.attachLocation(t)),this.hasError=this.endpoint.hasError}error(t){this.endpoint.error(this.attachLocation(t)),this.hasError=this.endpoint.hasError}attachLocation(t){let{line:e,column:n}=this.location;return`${t} (occurred at ${e}:${n})`}};var et=class{constructor(t,e,n){this.skript=t;this.input=e;this.location=new D(e),this.logger=new K(n,this.location)}static{i(this,"SkriptParser")}logger;location;parse(t=!1){let e=[];for(;this.location.peekInput().trim()!=="";){let n=this.parseStructure();if(n.isFailure()){if(!t){this.logger.error(n.getError().message),this.location.advanceLine(),this.skipBlock(this.detectIndentation(),1);continue}this.logger.error("Script mode is not implemented.");continue}let r=n.getValue();if(this.location.peek()!==":"){this.logger.error("Expected ':' after structure"),this.location.advanceLine(),this.skipBlock(this.detectIndentation(),1);continue}if(this.location.advance(),this.location.peek()!==`
`){this.logger.error("Expected new line after ':'"),this.location.advanceLine(),this.skipBlock(this.detectIndentation(),1);continue}this.location.advance();let a=this.detectIndentation(),s=this.parseBlock(a);s.isFailure()||(r.block=s.getValue(),e.push(r))}return new V(e)}parseBlock(t,e=1){let n=new L([]);for(this.location.pushSnap(),this.location.snap();this.location.hasInput();){this.location.pushSnap();let r=this.detectIndentationCount(t);if(r===0)break;if(e!==r){this.location.snap();let s=this.displayIndentation(t),p=this.displayIndentation(this.detectIndentation());this.logger.error(`Invalid indentation; expected '${s}', found '${p}'`),this.location.advanceLine();continue}else this.location.popSnap();let a=this.parseStatement(t,e);if(a.isFailure()){this.logger.error(a.getError().message);continue}n.statements.push(a.getValue())}return y.success(n)}parseStatement(t,e){let n=this.location.peekInput(),r=[...this.skript.getSyntaxOfType(2),...this.skript.getSyntaxOfType(5)];for(let a of r){let s=a.matchPattern(n,{skript:this.skript});if(!s)continue;this.location.advance(s.size);let p=a.initialize(this.skript,s);if(p instanceof I)if(this.location.peek()!==":")this.logger.error("Expected ':' after section"),this.location.advanceLine(),this.skipBlock(t,e+1);else{this.location.advance();let c=this.parseBlock(t,e+1);c.isSuccess()&&(p.block=c.getValue())}else this.location.advanceLine();return y.success(p)}return this.location.peekLine().endsWith(":")?(this.location.advanceLine(),this.skipBlock(t,e+1)):this.location.advanceLine(),y.failure(new Error("Unrecognized effect or section"))}parseStructure(){let t=this.skript.getSyntaxOfType(0),e=this.location.peekInput();for(let n of t){let r=n.matchPattern(e,{skript:this.skript});if(r)return this.location.advance(r.size),y.success(n.initialize(this.skript,r))}return y.failure(new Error("Unrecognized structure"))}skipBlock(t,e){for(;this.location.hasInput();)this.detectIndentationCount(t)>=e&&this.location.advanceLine()}detectIndentation(){this.location.pushSnap();let t="",e;for(;this.location.hasInput()&&((e=this.location.peek())===" "||e==="	");)t+=e,this.location.advance();return this.location.snap(),t}detectIndentationCount(t){let e=0;for(;this.location.peekInput().startsWith(t);)this.location.advance(t.length),e++;let n;if((n=this.location.peek())===" "||n==="	"){let r=this.displayIndentation(t),a=this.displayIndentation(this.detectIndentation());this.logger.error(`Indentation is inconsistent; expected '${r}', found '${a}'`)}return e}displayIndentation(t){return t.replace(/ /g,"s").replace(/\t/g,"t")}};var rt=class{static{i(this,"SimpleLogger")}entries=[];hasError=!1;log(t,e){let n=new Y(t,e);this.entries.push(n)}info(t){this.log(0,t)}warn(t){this.log(1,t)}error(t){this.log(2,t),this.hasError=!0}},Y=class{constructor(t,e){this.level=t;this.message=e}static{i(this,"LogEntry")}},ot=(n=>(n[n.Info=0]="Info",n[n.Warning=1]="Warning",n[n.Error=2]="Error",n))(ot||{});var U=class{constructor(t){this.skript=t}static{i(this,"SkriptExtension")}isInitialized=!1;syntaxRegistry=new G;initialize(){if(this.isInitialized)throw new Error(`Extension '${this.name}' has already been initialized.`);this.isInitialized=!0,this.onInitialize()}};var q=class o extends g{constructor(e,n,r,a){super(a);this.mode=e;this.changing=n;this.changeWith=r}static{i(this,"ModifyEffect")}static Registration=class extends h{static{i(this,"Registration")}rawPatterns(){return["set %objects% to %objects%","(give|add) %objects% to %objects%","(remove|subtract) %objects% from %objects%","delete %objects%"]}syntaxElement(){return o}initialize(e,{expressions:n,patternNumber:r}){let a,s=null;switch(r){case 0:{a=n[0],s=n[1];break}case 1:case 2:{a=n[1],s=n[0];break}case 3:{a=n[0];break}default:throw new Error(`Invalid change mode ${r}`)}return new o(r,a,s,e)}};execute(e){console.log("Execute",B[this.mode],e,this.changeWith),this.changing.change(this.mode,e,this.changeWith)}};var H=class o extends g{constructor(e,n){super(n);this.expression=e}static{i(this,"PrintEffect")}static Registration=class extends h{static{i(this,"Registration")}rawPatterns(){return["print %objects% [to console]"]}syntaxElement(){return o}initialize(e,n){return new o(n.expressions[0],e)}};execute(e){for(let n of this.expression.get(e))console.log(n)}};var J=class o extends l{static{i(this,"TestExpression")}static Registration=class extends h{static{i(this,"Registration")}rawPatterns(){return["test expr"]}syntaxElement(){return o}initialize(t,e){return new o(t)}};isSingle(){return!0}get(){return["hello world"]}getReturnType(){return String}toString(t){return"test expression"}};var Q=class o extends M{static{i(this,"ScriptLoadStructure")}static Registration=class extends h{static{i(this,"Registration")}rawPatterns(){return["[on] script load"]}syntaxElement(){return o}initialize(t,e){return new o(t)}};postLoad(){this.trigger()}};var nt=class extends U{static{i(this,"CoreExtension")}name="core";onInitialize(){let{syntaxRegistry:t}=this;t.registerSyntaxElement(new q.Registration(this.skript)),t.registerSyntaxElement(new Q.Registration(this.skript)),t.registerSyntaxElement(new H.Registration(this.skript)),t.registerSyntaxElement(new J.Registration(this.skript))}};return mt(ht);})();
