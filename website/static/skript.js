"use strict";var skriptWeb=(()=>{var z=Object.defineProperty;var _t=Object.getOwnPropertyDescriptor;var te=Object.getOwnPropertyNames;var ee=Object.prototype.hasOwnProperty;var re=(l,t,e)=>t in l?z(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var i=(l,t)=>z(l,"name",{value:t,configurable:!0});var ne=(l,t)=>{for(var e in t)z(l,e,{get:t[e],enumerable:!0})},ie=(l,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of te(t))!ee.call(l,r)&&r!==e&&z(l,r,{get:()=>t[r],enumerable:!(n=_t(t,r))||n.enumerable});return l};var oe=l=>ie(z({},"__esModule",{value:!0}),l);var s=(l,t,e)=>re(l,typeof t!="symbol"?t+"":t,e);var se={};ne(se,{Block:()=>F,BlockContainer:()=>E,BooleanExpression:()=>D,ChangeMode:()=>at,ChoiceElement:()=>k,CoreExtension:()=>Jt,Effect:()=>g,Expression:()=>u,ExpressionElement:()=>y,ExtensionRegistry:()=>O,GroupElement:()=>w,Integer:()=>C,IntegerExpression:()=>V,LiteralElement:()=>T,Location:()=>_,LocationProxyLogger:()=>tt,LogEntry:()=>mt,LogLevel:()=>Zt,MatchPatternResult:()=>m,ModifyEffect:()=>rt,NumberExpression:()=>K,Pattern:()=>Q,PatternElement:()=>Pt,PrintEffect:()=>nt,RegexElement:()=>J,Result:()=>x,Script:()=>Y,ScriptLoadStructure:()=>ot,Section:()=>$,SectionAction:()=>Yt,SimpleLogger:()=>Kt,Skript:()=>gt,SkriptExtension:()=>et,SkriptParser:()=>Dt,StringExpression:()=>U,Structure:()=>N,SyntaxElement:()=>f,SyntaxRegistration:()=>b,SyntaxRegistry:()=>X,SyntaxType:()=>d,TestExpression:()=>it,Type:()=>j,Types:()=>A,VariableExpression:()=>q,VariableMap:()=>xt,haltCharacters:()=>G});var ht=class ht{constructor(t){this.skript=t;s(this,"extensions",new Map)}registerExtension(t){let e=new t(this.skript);this.extensions.set(t,e),e.initialize()}getExtension(t){return this.extensions.get(t)}getExtensions(){return Array.from(this.extensions.values())}};i(ht,"ExtensionRegistry");var O=ht;var bt=class bt{constructor(t,e){this.type=t;this.ids=e;s(this,"toString",this.defaultToString);s(this,"change",this.defaultChange);s(this,"acceptChange",this.defaultAcceptChange)}setToString(t){this.toString=t}setChange(t){this.change=t}setAcceptChange(t){this.acceptChange=t}defaultToString(t){return t.toString()}defaultChange(t,e,n){}defaultAcceptChange(t,e,n){return!1}};i(bt,"Type");var j=bt;var ft=class ft{constructor(){s(this,"types",new Map);s(this,"idMap",new Map)}registerType(t,...e){let n=new j(t,e);this.idMap.set(t,e[0]);for(let r of e){if(this.types.has(r))throw new Error(`There is already a registered type with id '${r}'`);this.types.set(r,n)}return n}getType(t){if(t instanceof Function){let e=this.idMap.get(t);if(!e)throw new Error(`Type with class '${t.name}' doesn't exist.`);return this.types.get(e)}if(!this.types.has(t))throw new Error(`Type '${t}' is not registered.`);return this.types.get(t)}};i(ft,"Types");var A=ft;var yt=class yt{constructor(){s(this,"extensions",new O(this));s(this,"types",new A)}getSyntaxOfType(t){return this.extensions.getExtensions().map(e=>e.syntaxRegistry.getSyntaxOfType(t)).flat()}};i(yt,"Skript");var gt=yt;var dt=class dt{constructor(){s(this,"internalMap",new Map)}set(t,e){}};i(dt,"VariableMap");var xt=dt;var at=(r=>(r[r.Set=0]="Set",r[r.Add=1]="Add",r[r.Subtract=2]="Subtract",r[r.Delete=3]="Delete",r))(at||{});var kt=class kt{constructor(t){this.skript=t}};i(kt,"SyntaxElement");var f=kt,d=(o=>(o[o.Structure=0]="Structure",o[o.Event=1]="Event",o[o.Effect=2]="Effect",o[o.Expression=3]="Expression",o[o.Condition=4]="Condition",o[o.Section=5]="Section",o))(d||{});var St=class St extends f{constructor(){super(...arguments);s(this,"structure",null);s(this,"block",null)}trigger(){this.block.evaluate(this)}};i(St,"BlockContainer");var E=St;var Et=class Et extends E{constructor(e){super(e);s(this,"symbols",new Map);this.structure=this,this.preLoad()}preLoad(){}postLoad(){}getSyntaxType(){return 0}};i(Et,"Structure");var N=Et;var wt=class wt extends E{constructor(e,n){super(n);this.parent=e;this.structure=e.structure}walk(e){}getSyntaxType(){return 5}};i(wt,"Section");var $=wt,Yt=(e=>(e[e.Execute=0]="Execute",e[e.Skip=1]="Skip",e))(Yt||{});var Ct=class Ct extends f{change(t,e,n){}acceptChange(t,e,n){return!1}getSyntaxType(){return 3}};i(Ct,"Expression");var u=Ct;var Tt=class Tt extends f{getSyntaxType(){return 2}};i(Tt,"Effect");var g=Tt;var vt=class vt{constructor(t){this.statements=t}evaluate(t){for(let e of this.statements){if(e instanceof g){e.execute(t);continue}e.block.evaluate(t)}}};i(vt,"Block");var F=vt;var pt=class pt{constructor(t,e){this.element=t;this.isOptional=e}createPattern(t,{skript:e,isOptional:n}){let[r,a]=[["(",")"],["[","]"]][+n],o=0;if(t[o++]!==r)throw new Error(`Expected '${r}'`);let p=[];for(;t[o]!==a;){let[c,h]=w.prototype.createPattern(t.substring(o),{skript:e});p.push(c),o+=h,t[o]==="|"&&o++}if(t[o++]!==a)throw new Error(`Expected '${a}'`);return[new pt(p,n),o]}matchPattern(t,{skript:e}){for(let n of this.element){let r=n.matchPattern(t,{skript:e});if(r)return r}return null}};i(pt,"ChoiceElement");var k=pt;var Rt=class Rt{constructor(t,e=[],n=[],r=-1){this.size=t;this.regexes=e;this.expressions=n;this.patternNumber=r}};i(Rt,"MatchPatternResult");var m=Rt,Bt=class Bt{};i(Bt,"PatternElement");var Pt=Bt,G=["(",")","[","]","<","%","|"];var Mt=class Mt extends u{constructor(e,n){super(n);this.value=e}getReturnType(){return Boolean}isSingle(){return!0}get(){return[this.value]}toString(e){return this.value.toString()}};i(Mt,"BooleanExpression");var D=Mt;var It=class It extends Number{};i(It,"Integer");var C=It,Lt=class Lt extends u{constructor(e,n){super(n);this.value=e}getReturnType(){return C}isSingle(){return!0}get(){return[this.value]}toString(e){return this.value.toString()}};i(Lt,"IntegerExpression");var V=Lt;var Wt=class Wt extends u{constructor(e,n){super(n);this.value=e}getReturnType(){return Number}isSingle(){return!0}get(){return[this.value]}toString(e){return this.value.toString()}};i(Wt,"NumberExpression");var K=Wt;var zt=class zt extends u{constructor(e,n){super(n);this.value=e}getReturnType(){return String}isSingle(){return!0}get(){return[this.value]}toString(e){return this.value}};i(zt,"StringExpression");var U=zt;var Ot=class Ot extends u{constructor(e,n){super(n);this.name=e;s(this,"cachedName",null)}getReturnType(){return Object}isSingle(){return!0}get(e){let n=this.getName(e);return[e.structure.symbols.get(n)]}change(e,n,r){let{symbols:a}=n.structure,o=this.getName(n);switch(e){case 0:{a.set(o,r.get(n));break}case 1:case 2:{let p=a.get(o),c=r.get(n);if(console.log({name:o}),!o.endsWith("::*")){let S=n.skript.types.getType(p.constructor);console.log({type:S}),S.change(e,n,r);return}let h=e===1?p.push:(...S)=>{for(let st of S){let Xt=p.indexOf(st);Xt!==-1&&p.splice(Xt,1)}};Array.isArray(c)?h(...c.flat()):h(c);break}case 3:{a.delete(o);break}}}acceptChange(e,n,r){let a=this.getName(n),o=n.structure.symbols.get(a);return!((e===1||e===2)&&!Array.isArray(o))}toString(e){let n=e.structure.symbols.get(this.name);return this.skript.types.getType(n.constructor).toString(n)}getName(e){return this.cachedName?this.cachedName:this.cachedName=this.evaluateName(e)}evaluateName(e){let n=this.skript.types.getType(Object),r=0,a="";for(;r<this.name.length;){let o=this.name[r++];if(o==="%"){if(this.name[r]==="%"){a+="%",r++;continue}let c=new y(n).matchPattern(this.name.substring(r),{skript:this.skript});if(a+=c.expressions[0].toString(e),this.name[r++]!=="%")throw new Error("Expected '%'");continue}a+=o}return a}};i(Ot,"VariableExpression");var q=Ot;var H=class H{constructor(t){this.type=t}createPattern(t,{skript:e}){let n="",r=0;if(t[r++]!=="%")throw new Error("Expected '%'");for(;r<t.length&&t[r]!=="%";)n+=t[r++];if(t[r++]!=="%")throw new Error("Expected '%'");return[new H(e.types.getType(n)),r]}matchPattern(t,{skript:e}){let n=e.getSyntaxOfType(3),r=0,a=i(o=>o>="0"&&o<="9","isDigit");switch(!0){case t[r]==='"':{if(this.type.type!==String&&this.type.type!==Object)break;r++;let o="";for(;r<t.length&&t[r]!=='"';){if(t[r]==="\\"){r++,o+=t[r++];continue}o+=t[r++]}if(t[r++]!=='"')break;return new m(r,[],[new U(o,e)])}case a(t[r]):{if(!a(t[r]))break;let o=0,p=0;for(;r<t.length&&a(t[r])||o===0&&t[r]===".";){if(o===0){if(t[r]==="."){o=.1;continue}p*=10,p+=t.charCodeAt(r++)-48;continue}p+=(t.charCodeAt(r++)-48)*o,o/=10}let c=o===0&&(this.type.type===C||this.type.type===Object)?new V(p,e):new K(p,e);return new m(r,[],[c])}case(t.startsWith("true")||t.startsWith("false")):{if(this.type.type!==Boolean&&this.type.type!==Object)break;let o=t.startsWith("true");if(r+=o?4:5,r<t.length&&t[r]>="a"&&t[r]<="z"||a(t[r]))break;return new m(r,[],[new D(o,e)])}}if(t[r]==="{"){let o=e.types.getType(Object),p=new H(o),c="";for(r++;r<t.length&&t[r]!=="}"&&t[r]!==`
`;){let h=t[r++];if(h==="%"){if(t[r]==="%"){c+="%",r++;continue}let S=p.matchPattern(t.substring(r),{skript:e});if(!S)return null;for(let st=0;st<S.size;st++)c+=t[r++];if(t[r++]!=="%")return null;continue}c+=h}return t[r++]!=="}"?null:new m(r,[],[new q(c,e)])}for(let o of n){let p=o.syntaxElement();if(this.type.type!==Object&&p.prototype.getReturnType()!==this.type.type)continue;let c=o.matchPattern(t,{skript:e});if(c)return new m(c.size,[],[o.initialize(e,c)])}return null}};i(H,"ExpressionElement");var y=H;var ct=class ct{constructor(t){this.value=t}createPattern(t){let e="",n=0;for(;n<t.length&&!G.includes(t[n]);)e+=t[n++];return[new ct(e.trim()),n]}matchPattern(t){return t.startsWith(this.value)?new m(this.value.length,[]):null}};i(ct,"LiteralElement");var T=ct;var lt=class lt{constructor(t){this.regex=t}createPattern(t){let e="^",n=0;if(t[n++]!=="<")throw new Error("Expected '<'");for(;n<t.length&&t[n]!==">";){let r=t[n++];if(r==="\\"&&t[n]===">"){e+=">",n++;continue}e+=r}if(t[n++]!==">")throw new Error("Expected '>'");return[new lt(new RegExp(e,"g")),n]}matchPattern(t){let e=t.match(this.regex);return e?new m(e[0].length,[e[0]]):null}};i(lt,"RegexElement");var J=lt;var ut=class ut{constructor(t){this.elements=t}createPattern(t,{skript:e}){let n=[],r=0;t:for(;r<t.length;){let a=t.substring(r),o=a[0];if(a.startsWith(" ")){r++;continue}switch(o){case"%":{let[p,c]=y.prototype.createPattern(a,{skript:e});n.push(p),r+=c;break}case"(":{let[p,c]=k.prototype.createPattern(a,{skript:e,isOptional:!1});n.push(p),r+=c;break}case"[":{let[p,c]=k.prototype.createPattern(a,{skript:e,isOptional:!0});n.push(p),r+=c;break}case"<":{let[p,c]=J.prototype.createPattern(a);n.push(p),r+=c;break}default:{if(G.includes(o))break t;let[p,c]=T.prototype.createPattern(a);n.push(p),r+=c;break}}}return[new ut(n),r]}matchPattern(t,{skript:e,patternNumber:n=-1}){let r=[],a=[],o=0,p;for(let c of this.elements){let h=t.substring(o);switch(!0){case c instanceof y:{p=c.matchPattern(h,{skript:e});break}case c instanceof k:{p=c.matchPattern(h,{skript:e,isOptional:c.isOptional});break}default:{p=c.matchPattern(h,{});break}}if(!p){if(c instanceof k&&c.isOptional)continue;return null}for(c instanceof y?r.push(...p.expressions):a.push(...p.regexes),o+=p.size;t.substring(o).startsWith(" ");)o++}return new m(o,a,r,n)}getKeywords(){return this.elements.filter(t=>t instanceof T).map(t=>t.value)}};i(ut,"GroupElement");var w=ut;var jt=class jt{constructor(t,e){this.pattern=e;s(this,"compiledPattern");this.compiledPattern=w.prototype.createPattern(this.pattern,{skript:t,patternNumber:-1})[0]}};i(jt,"Pattern");var Q=jt;var At=class At{constructor(){s(this,"syntax",new Map)}registerSyntaxElement(t){let e=t.syntaxElement().prototype.getSyntaxType();this.syntax.has(e)||this.syntax.set(e,[]),this.syntax.get(e).push(t)}getSyntaxOfType(t){var e;return(e=this.syntax.get(t))!=null?e:[]}};i(At,"SyntaxRegistry");var X=At,Nt=class Nt{constructor(t){s(this,"patterns");this.patterns=this.rawPatterns().map(e=>new Q(t,e))}matchPattern(t,{skript:e}){for(let[n,{compiledPattern:r}]of Object.entries(this.patterns)){if(r.getKeywords().find(o=>!t.includes(o)))continue;let a=r.matchPattern(t,{skript:e,patternNumber:parseInt(n)});if(a)return a}return null}};i(Nt,"SyntaxRegistration");var b=Nt;var $t=class $t{constructor(t){this.structures=t}};i($t,"Script");var Y=$t;var Z=class Z{constructor(t,e){this.value=t;this.error=e}static success(t){return new Z(t,null)}static failure(t){return new Z(null,t)}isSuccess(){return this.value!==null&&this.error===null}isFailure(){return this.value===null&&this.error!==null}getValue(){if(this.value===null)throw new Error("Result doesn't have a value");return this.value}getError(){if(this.error===null)throw new Error("Error doesn't have a value");return this.error}};i(Z,"Result");var x=Z;var Ft=class Ft{constructor(t){this.input=t;s(this,"index",0);s(this,"line",0);s(this,"column",1);s(this,"snapStack",[])}advance(t=1){for(let e=0;e<t;e++){let n=this.input[this.index++];this.column++,n===`
`&&(this.line++,this.column=1)}return this}advanceLine(){for(;this.hasInput()&&this.input[this.index++]!==`
`;);return this.line++,this.column=1,this}peek(){return this.input[this.index]}peekLine(){let t=this.input.substring(this.index);return t.substring(0,t.indexOf(`
`))}peekInput(){return this.input.substring(this.index)}hasInput(){return this.input.substring(this.index).trim()!==""}pushSnap(){this.snapStack.push([this.index,this.line,this.column])}popSnap(){this.snapStack.pop()}snap(){let[t,e,n]=this.snapStack.pop();this.index=t,this.line=e,this.column=n}};i(Ft,"Location");var _=Ft;var Gt=class Gt{constructor(t,e){this.endpoint=t;this.location=e;s(this,"entries");s(this,"hasError",!1);this.entries=t.entries}log(t,e){this.endpoint.log(t,e),this.hasError=this.endpoint.hasError}info(t){this.endpoint.info(this.attachLocation(t)),this.hasError=this.endpoint.hasError}warn(t){this.endpoint.warn(this.attachLocation(t)),this.hasError=this.endpoint.hasError}error(t){this.endpoint.error(this.attachLocation(t)),this.hasError=this.endpoint.hasError}attachLocation(t){let{line:e,column:n}=this.location;return`${t} (occurred at ${e}:${n})`}};i(Gt,"LocationProxyLogger");var tt=Gt;var Vt=class Vt{constructor(t,e,n){this.skript=t;this.input=e;s(this,"logger");s(this,"location");this.location=new _(e),this.logger=new tt(n,this.location)}parse(t=!1){let e=[];for(;this.location.peekInput().trim()!=="";){let n=this.parseStructure();if(n.isFailure()){if(!t){this.logger.error(n.getError().message),this.location.advanceLine(),this.skipBlock(this.detectIndentation(),1);continue}this.logger.error("Script mode is not implemented.");continue}let r=n.getValue();if(this.location.peek()!==":"){this.logger.error("Expected ':' after structure"),this.location.advanceLine(),this.skipBlock(this.detectIndentation(),1);continue}if(this.location.advance(),this.location.peek()!==`
`){this.logger.error("Expected new line after ':'"),this.location.advanceLine(),this.skipBlock(this.detectIndentation(),1);continue}this.location.advance();let a=this.detectIndentation(),o=this.parseBlock(a);o.isFailure()||(r.block=o.getValue(),e.push(r))}return new Y(e)}parseBlock(t,e=1){let n=new F([]);for(this.location.pushSnap(),this.location.snap();this.location.hasInput();){this.location.pushSnap();let r=this.detectIndentationCount(t);if(r===0)break;if(e!==r){this.location.snap();let o=this.displayIndentation(t),p=this.displayIndentation(this.detectIndentation());this.logger.error(`Invalid indentation; expected '${o}', found '${p}'`),this.location.advanceLine();continue}else this.location.popSnap();let a=this.parseStatement(t,e);if(a.isFailure()){this.logger.error(a.getError().message);continue}n.statements.push(a.getValue())}return x.success(n)}parseStatement(t,e){let n=this.location.peekInput(),r=[...this.skript.getSyntaxOfType(2),...this.skript.getSyntaxOfType(5)];for(let a of r){let o=a.matchPattern(n,{skript:this.skript});if(!o)continue;this.location.advance(o.size);let p=a.initialize(this.skript,o);if(p instanceof $)if(this.location.peek()!==":")this.logger.error("Expected ':' after section"),this.location.advanceLine(),this.skipBlock(t,e+1);else{this.location.advance();let c=this.parseBlock(t,e+1);c.isSuccess()&&(p.block=c.getValue())}else this.location.advanceLine();return x.success(p)}return this.location.peekLine().endsWith(":")?(this.location.advanceLine(),this.skipBlock(t,e+1)):this.location.advanceLine(),x.failure(new Error("Unrecognized effect or section"))}parseStructure(){let t=this.skript.getSyntaxOfType(0),e=this.location.peekInput();for(let n of t){let r=n.matchPattern(e,{skript:this.skript});if(r)return this.location.advance(r.size),x.success(n.initialize(this.skript,r))}return x.failure(new Error("Unrecognized structure"))}skipBlock(t,e){for(;this.location.hasInput();)this.detectIndentationCount(t)>=e&&this.location.advanceLine()}detectIndentation(){this.location.pushSnap();let t="",e;for(;this.location.hasInput()&&((e=this.location.peek())===" "||e==="	");)t+=e,this.location.advance();return this.location.snap(),t}detectIndentationCount(t){let e=0;for(;this.location.peekInput().startsWith(t);)this.location.advance(t.length),e++;let n;if((n=this.location.peek())===" "||n==="	"){let r=this.displayIndentation(t),a=this.displayIndentation(this.detectIndentation());this.logger.error(`Indentation is inconsistent; expected '${r}', found '${a}'`)}return e}displayIndentation(t){return t.replace(/ /g,"s").replace(/\t/g,"t")}};i(Vt,"SkriptParser");var Dt=Vt;var Ut=class Ut{constructor(){s(this,"entries",[]);s(this,"hasError",!1)}log(t,e){let n=new mt(t,e);this.entries.push(n)}info(t){this.log(0,t)}warn(t){this.log(1,t)}error(t){this.log(2,t),this.hasError=!0}};i(Ut,"SimpleLogger");var Kt=Ut,qt=class qt{constructor(t,e){this.level=t;this.message=e}};i(qt,"LogEntry");var mt=qt,Zt=(n=>(n[n.Info=0]="Info",n[n.Warning=1]="Warning",n[n.Error=2]="Error",n))(Zt||{});var Ht=class Ht{constructor(t){this.skript=t;s(this,"isInitialized",!1);s(this,"syntaxRegistry",new X)}initialize(){if(this.isInitialized)throw new Error(`Extension '${this.name}' has already been initialized.`);this.isInitialized=!0,this.onInitialize()}};i(Ht,"SkriptExtension");var et=Ht;var P,v=class v extends g{constructor(e,n,r,a){super(a);this.mode=e;this.changing=n;this.changeWith=r}execute(e){this.changing.change(this.mode,e,this.changeWith)}};i(v,"ModifyEffect"),s(v,"Registration",(P=class extends b{rawPatterns(){return["set %objects% to %objects%","(give|add) %objects% to %objects%","(remove|subtract) %objects% from %objects%","delete %objects%"]}syntaxElement(){return v}initialize(n,{expressions:r,patternNumber:a}){let o,p=null;switch(a){case 0:{o=r[0],p=r[1];break}case 1:case 2:{o=r[1],p=r[0];break}case 3:{o=r[0];break}default:throw new Error(`Invalid change mode ${a}`)}return new v(a,o,p,n)}},i(P,"Registration"),P));var rt=v;var B,R=class R extends g{constructor(e,n){super(n);this.expression=e}execute(e){for(let n of this.expression.get(e))if(Array.isArray(n))for(let r of n)console.log(r);else console.log(n)}};i(R,"PrintEffect"),s(R,"Registration",(B=class extends b{rawPatterns(){return["print %objects% [to console]"]}syntaxElement(){return R}initialize(n,r){return new R(r.expressions[0],n)}},i(B,"Registration"),B));var nt=R;var I,M=class M extends u{isSingle(){return!0}get(){return["hello world"]}getReturnType(){return String}toString(t){return"test expression"}};i(M,"TestExpression"),s(M,"Registration",(I=class extends b{rawPatterns(){return["test expr"]}syntaxElement(){return M}initialize(e,n){return new M(e)}},i(I,"Registration"),I));var it=M;var W,L=class L extends N{postLoad(){this.trigger()}};i(L,"ScriptLoadStructure"),s(L,"Registration",(W=class extends b{rawPatterns(){return["[on] script load"]}syntaxElement(){return L}initialize(e,n){return new L(e)}},i(W,"Registration"),W));var ot=L;var Qt=class Qt extends et{constructor(){super(...arguments);s(this,"name","core")}onInitialize(){let{syntaxRegistry:e}=this;e.registerSyntaxElement(new rt.Registration(this.skript)),e.registerSyntaxElement(new ot.Registration(this.skript)),e.registerSyntaxElement(new nt.Registration(this.skript)),e.registerSyntaxElement(new it.Registration(this.skript))}};i(Qt,"CoreExtension");var Jt=Qt;return oe(se);})();
