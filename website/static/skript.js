var Kt=Object.defineProperty;var Yt=(x,t,e)=>t in x?Kt(x,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):x[t]=e;var i=(x,t)=>Kt(x,"name",{value:t,configurable:!0});var s=(x,t,e)=>Yt(x,typeof t!="symbol"?t+"":t,e);var lt=class lt{constructor(t){this.skript=t;s(this,"extensions",new Map)}registerExtension(t){let e=new t(this.skript);this.extensions.set(t,e),e.initialize()}getExtension(t){return this.extensions.get(t)}getExtensions(){return Array.from(this.extensions.values())}};i(lt,"ExtensionRegistry");var $=lt;var ut=class ut{constructor(t,e){this.type=t;this.ids=e;s(this,"toString",this.defaultToString)}setToString(t){this.toString=t}defaultToString(t){return t.toString()}};i(ut,"Type");var W=ut;var mt=class mt{constructor(){s(this,"types",new Map);s(this,"idMap",new Map)}registerType(t,...e){let n=new W(t,e);this.idMap.set(t,e[0]);for(let r of e){if(this.types.has(r))throw new Error(`There is already a registered type with id '${r}'`);this.types.set(r,n)}return n}getType(t){if(t instanceof Function){let e=this.idMap.get(t);if(!e)throw new Error(`Type with class '${t.name}' doesn't exist.`);return this.types.get(e)}if(!this.types.has(t))throw new Error(`Type '${t}' is not registered.`);return this.types.get(t)}};i(mt,"Types");var A=mt;var ht=class ht{constructor(){s(this,"extensions",new $(this));s(this,"types",new A)}getSyntaxOfType(t){return this.extensions.getExtensions().map(e=>e.syntaxRegistry.getSyntaxOfType(t)).flat()}};i(ht,"Skript");var Ut=ht;var ft=class ft{constructor(){s(this,"internalMap",new Map)}set(t,e){}};i(ft,"VariableMap");var qt=ft;var bt=(r=>(r[r.Set=0]="Set",r[r.Add=1]="Add",r[r.Subtract=2]="Subtract",r[r.Delete=3]="Delete",r))(bt||{});var gt=class gt{constructor(t){this.skript=t}};i(gt,"SyntaxElement");var f=gt,d=(o=>(o[o.Structure=0]="Structure",o[o.Event=1]="Event",o[o.Effect=2]="Effect",o[o.Expression=3]="Expression",o[o.Condition=4]="Condition",o[o.Section=5]="Section",o))(d||{});var yt=class yt extends f{change(t,e,n){}acceptChange(t,e,n){return!1}getSyntaxType(){return 3}};i(yt,"Expression");var l=yt;var xt=class xt extends l{constructor(e,n){super(n);this.value=e}getReturnType(){return Boolean}isSingle(){return!0}get(){return[this.value]}toString(e){return this.value.toString()}};i(xt,"BooleanExpression");var F=xt;var dt=class dt extends Number{};i(dt,"Integer");var I=dt,kt=class kt extends l{constructor(e,n){super(n);this.value=e}getReturnType(){return I}isSingle(){return!0}get(){return[this.value]}toString(e){return this.value.toString()}};i(kt,"IntegerExpression");var G=kt;var St=class St extends l{constructor(e,n){super(n);this.value=e}getReturnType(){return Number}isSingle(){return!0}get(){return[this.value]}toString(e){return this.value.toString()}};i(St,"NumberExpression");var D=St;var Et=class Et extends l{constructor(e,n){super(n);this.value=e}getReturnType(){return String}isSingle(){return!0}get(){return[this.value]}toString(e){return this.value}};i(Et,"StringExpression");var V=Et;var wt=class wt{constructor(t,e=[],n=[],r=-1){this.size=t;this.regexes=e;this.expressions=n;this.patternNumber=r}};i(wt,"MatchPatternResult");var u=wt,Ct=class Ct{};i(Ct,"PatternElement");var Ht=Ct,K=["(",")","[","]","<","%","|"];var L=class L{constructor(t){this.type=t}createPattern(t,{skript:e}){let n="",r=0;if(t[r++]!=="%")throw new Error("Expected '%'");for(;r<t.length&&t[r]!=="%";)n+=t[r++];if(t[r++]!=="%")throw new Error("Expected '%'");return console.log({skript:e}),[new L(e.types.getType(n)),r]}matchPattern(t,{skript:e}){let n=e.getSyntaxOfType(3),r=0,a=i(o=>o>="0"&&o<="9","isDigit");switch(!0){case t[r]==='"':{if(this.type.type!==String&&this.type.type!==Object)break;r++;let o="";for(;r<t.length&&t[r]!=='"';){if(t[r]==="\\"){r++,o+=t[r++];continue}o+=t[r++]}if(t[r++]!=='"')break;return new u(r,[],[new V(o,e)])}case a(t[r]):{if(!a(t[r]))break;let o=0,p=0;for(;r<t.length&&a(t[r])||o===0&&t[r]===".";){if(o===0){if(t[r]==="."){o=.1;continue}p*=10,p+=t.charCodeAt(r++)-48;continue}p+=(t.charCodeAt(r++)-48)*o,o/=10}let c=o===0&&(this.type.type===I||this.type.type===Object)?new G(p,e):new D(p,e);return new u(r,[],[c])}case(t.startsWith("true")||t.startsWith("false")):{if(this.type.type!==Boolean&&this.type.type!==Object)break;let o=t.startsWith("true");if(r+=o?4:5,r<t.length&&t[r]>="a"&&t[r]<="z"||a(t[r]))break;return new u(r,[],[new F(o,e)])}}if(t[r]==="{"){let o=e.types.getType(Object),p=new L(o),c="";for(r++;r<t.length&&t[r]!=="}"&&t[r]!==`
`;){let m=t[r++];if(m==="%"){if(t[r]==="%"){c+="%",r++;continue}let j=p.matchPattern(t.substring(r),{skript:e});if(!j)return null;for(let N=0;N<j.size;N++)c+=t[r++];if(t[r++]!=="%")return null;continue}c+=m}return t[r++]!=="}"?null:new u(r,[],[new U(c,e)])}for(let o of n){let p=o.syntaxElement();if(this.type.type!==Object&&p.prototype.getReturnType()!==this.type.type)continue;let c=o.matchPattern(t,{skript:e});if(c)return new u(c.size,[],[o.initialize(e,c)])}return null}};i(L,"ExpressionElement");var b=L;var vt=class vt extends l{constructor(e,n){super(n);this.name=e;s(this,"cachedName",null)}getReturnType(){return Object}isSingle(){return!0}get(e){let n=this.getName(e);return[e.structure.symbols.get(n)]}change(e,n,r){let{symbols:a}=n.structure,o=this.getName(n);switch(e){case 0:{a.set(o,r.get(n));break}case 1:case 2:{let p=a.get(o),c=r.get(n),m=e===1?p.push:(...j)=>{for(let N of j){let Vt=p.indexOf(N);Vt!==-1&&p.splice(Vt,1)}};Array.isArray(c)?m(...c.flat()):m(c);break}case 3:{a.delete(o);break}}}acceptChange(e,n,r){let a=this.getName(n),o=n.structure.symbols.get(a);return!((e===1||e===2)&&!Array.isArray(o))}toString(e){let n=e.structure.symbols.get(this.name);return this.skript.types.getType(n.constructor).toString(n)}getName(e){return this.cachedName?this.cachedName:this.cachedName=this.evaluateName(e)}evaluateName(e){let n=this.skript.types.getType(Object),r=0,a="";for(;r<this.name.length;){let o=this.name[r++];if(o==="%"){if(this.name[r]==="%"){a+="%",r++;continue}let c=new b(n).matchPattern(this.name.substring(r),{skript:this.skript});if(a+=c.expressions[0].toString(e),this.name[r++]!=="%")throw new Error("Expected '%'");continue}a+=o}return a}};i(vt,"VariableExpression");var U=vt;var z=class z{constructor(t,e){this.value=t;this.error=e}static success(t){return new z(t,null)}static failure(t){return new z(null,t)}isSuccess(){return this.value!==null&&this.error===null}isFailure(){return this.value===null&&this.error!==null}getValue(){if(this.value===null)throw new Error("Result doesn't have a value");return this.value}getError(){if(this.error===null)throw new Error("Error doesn't have a value");return this.error}};i(z,"Result");var g=z;var Pt=class Pt extends f{getSyntaxType(){return 2}};i(Pt,"Effect");var y=Pt;var Tt=class Tt{constructor(t){this.statements=t}evaluate(t){for(let e of this.statements){if(e instanceof y){e.execute(t);continue}e.block.evaluate(t)}}};i(Tt,"Block");var q=Tt;var Rt=class Rt extends f{constructor(){super(...arguments);s(this,"structure",null);s(this,"block",null)}trigger(){this.block.evaluate(this)}};i(Rt,"BlockContainer");var S=Rt;var Bt=class Bt extends S{constructor(e,n){super(n);this.parent=e;this.structure=e.structure}walk(e){}getSyntaxType(){return 5}};i(Bt,"Section");var H=Bt,Zt=(e=>(e[e.Execute=0]="Execute",e[e.Skip=1]="Skip",e))(Zt||{});var Mt=class Mt extends S{constructor(e){super(e);s(this,"symbols",new Map);this.structure=this,this.preLoad()}preLoad(){}postLoad(){}getSyntaxType(){return 0}};i(Mt,"Structure");var J=Mt;var It=class It{constructor(t){this.input=t;s(this,"index",0);s(this,"line",0);s(this,"column",1);s(this,"snapStack",[])}advance(t=1){for(let e=0;e<t;e++){let n=this.input[this.index++];this.column++,n===`
`&&(this.line++,this.column=1)}return this}advanceLine(){for(;this.hasInput()&&this.input[this.index++]!==`
`;);return this.line++,this.column=1,this}peek(){return this.input[this.index]}peekLine(){let t=this.input.substring(this.index);return t.substring(0,t.indexOf(`
`))}peekInput(){return this.input.substring(this.index)}hasInput(){return this.input.substring(this.index).trim()!==""}pushSnap(){this.snapStack.push([this.index,this.line,this.column])}popSnap(){this.snapStack.pop()}snap(){let[t,e,n]=this.snapStack.pop();this.index=t,this.line=e,this.column=n}};i(It,"Location");var Q=It;var Lt=class Lt{constructor(t,e){this.endpoint=t;this.location=e;s(this,"entries");s(this,"hasError",!1);this.entries=t.entries}log(t,e){this.endpoint.log(t,e),this.hasError=this.endpoint.hasError}info(t){this.endpoint.info(this.attachLocation(t)),this.hasError=this.endpoint.hasError}warn(t){this.endpoint.warn(this.attachLocation(t)),this.hasError=this.endpoint.hasError}error(t){this.endpoint.error(this.attachLocation(t)),this.hasError=this.endpoint.hasError}attachLocation(t){let{line:e,column:n}=this.location;return`${t} (occurred at ${e}:${n})`}};i(Lt,"LocationProxyLogger");var X=Lt;var zt=class zt{constructor(t){this.structures=t}};i(zt,"Script");var Y=zt;var Ot=class Ot{constructor(t,e,n){this.skript=t;this.input=e;s(this,"logger");s(this,"location");this.location=new Q(e),this.logger=new X(n,this.location)}parse(t=!1){let e=[];for(;this.location.peekInput().trim()!=="";){let n=this.parseStructure();if(n.isFailure()){if(!t){this.logger.error(n.getError().message),this.location.advanceLine(),this.skipBlock(this.detectIndentation(),1);continue}this.logger.error("Script mode is not implemented.");continue}let r=n.getValue();if(this.location.peek()!==":"){this.logger.error("Expected ':' after structure"),this.location.advanceLine(),this.skipBlock(this.detectIndentation(),1);continue}if(this.location.advance(),this.location.peek()!==`
`){this.logger.error("Expected new line after ':'"),this.location.advanceLine(),this.skipBlock(this.detectIndentation(),1);continue}this.location.advance();let a=this.detectIndentation(),o=this.parseBlock(a);o.isFailure()||(r.block=o.getValue(),e.push(r))}return new Y(e)}parseBlock(t,e=1){let n=new q([]);for(this.location.pushSnap(),this.location.snap();this.location.hasInput();){this.location.pushSnap();let r=this.detectIndentationCount(t);if(r===0)break;if(e!==r){this.location.snap();let o=this.displayIndentation(t),p=this.displayIndentation(this.detectIndentation());this.logger.error(`Invalid indentation; expected '${o}', found '${p}'`),this.location.advanceLine();continue}else this.location.popSnap();let a=this.parseStatement(t,e);if(a.isFailure()){this.logger.error(a.getError().message);continue}n.statements.push(a.getValue())}return g.success(n)}parseStatement(t,e){let n=this.location.peekInput(),r=[...this.skript.getSyntaxOfType(2),...this.skript.getSyntaxOfType(5)];for(let a of r){let o=a.matchPattern(n,{skript:this.skript});if(!o)continue;this.location.advance(o.size);let p=a.initialize(this.skript,o);if(p instanceof H)if(this.location.peek()!==":")this.logger.error("Expected ':' after section"),this.location.advanceLine(),this.skipBlock(t,e+1);else{this.location.advance();let c=this.parseBlock(t,e+1);c.isSuccess()&&(p.block=c.getValue())}else this.location.advanceLine();return g.success(p)}return this.location.peekLine().endsWith(":")?(this.location.advanceLine(),this.skipBlock(t,e+1)):this.location.advanceLine(),g.failure(new Error("Unrecognized effect or section"))}parseStructure(){let t=this.skript.getSyntaxOfType(0),e=this.location.peekInput();for(let n of t){let r=n.matchPattern(e,{skript:this.skript});if(r)return this.location.advance(r.size),g.success(n.initialize(this.skript,r))}return g.failure(new Error("Unrecognized structure"))}skipBlock(t,e){for(;this.location.hasInput();)this.detectIndentationCount(t)>=e&&this.location.advanceLine()}detectIndentation(){this.location.pushSnap();let t="",e;for(;this.location.hasInput()&&((e=this.location.peek())===" "||e==="	");)t+=e,this.location.advance();return this.location.snap(),t}detectIndentationCount(t){let e=0;for(;this.location.peekInput().startsWith(t);)this.location.advance(t.length),e++;let n;if((n=this.location.peek())===" "||n==="	"){let r=this.displayIndentation(t),a=this.displayIndentation(this.detectIndentation());this.logger.error(`Indentation is inconsistent; expected '${r}', found '${a}'`)}return e}displayIndentation(t){return t.replace(/ /g,"s").replace(/\t/g,"t")}};i(Ot,"SkriptParser");var Jt=Ot;var Z=class Z{constructor(t,e){this.element=t;this.isOptional=e}createPattern(t,{skript:e,isOptional:n}){let[r,a]=[["(",")"],["[","]"]][+n],o=0;if(t[o++]!==r)throw new Error(`Expected '${r}'`);let p=[];for(;t[o]!==a;){let[c,m]=E.prototype.createPattern(t.substring(o),{skript:e});p.push(c),o+=m,t[o]==="|"&&o++}if(t[o++]!==a)throw new Error(`Expected '${a}'`);return[new Z(p,n),o]}matchPattern(t,{skript:e}){for(let n of this.element){let r=n.matchPattern(t,{skript:e});if(r)return r}return null}};i(Z,"ChoiceElement");var k=Z;var _=class _{constructor(t){this.value=t}createPattern(t){let e="",n=0;for(;n<t.length&&!K.includes(t[n]);)e+=t[n++];return[new _(e.trim()),n]}matchPattern(t){return t.startsWith(this.value)?new u(this.value.length,[]):null}};i(_,"LiteralElement");var O=_;var et=class et{constructor(t){this.regex=t}createPattern(t){let e="^",n=0;if(t[n++]!=="<")throw new Error("Expected '<'");for(;n<t.length&&t[n]!==">";){let r=t[n++];if(r==="\\"&&t[n]===">"){e+=">",n++;continue}e+=r}if(t[n++]!==">")throw new Error("Expected '>'");return[new et(new RegExp(e,"g")),n]}matchPattern(t){let e=t.match(this.regex);return e?new u(e[0].length,[e[0]]):null}};i(et,"RegexElement");var tt=et;var rt=class rt{constructor(t){this.elements=t}createPattern(t,{skript:e}){let n=[],r=0;t:for(;r<t.length;){let a=t.substring(r),o=a[0];if(a.startsWith(" ")){r++;continue}switch(o){case"%":{let[p,c]=b.prototype.createPattern(a,{skript:e});n.push(p),r+=c;break}case"(":{let[p,c]=k.prototype.createPattern(a,{skript:e,isOptional:!1});n.push(p),r+=c;break}case"[":{let[p,c]=k.prototype.createPattern(a,{skript:e,isOptional:!0});n.push(p),r+=c;break}case"<":{let[p,c]=tt.prototype.createPattern(a);n.push(p),r+=c;break}default:{if(K.includes(o))break t;let[p,c]=O.prototype.createPattern(a);n.push(p),r+=c;break}}}return[new rt(n),r]}matchPattern(t,{skript:e,patternNumber:n=-1}){let r=[],a=[],o=0,p;for(let c of this.elements){let m=t.substring(o);switch(!0){case c instanceof b:{p=c.matchPattern(m,{skript:e});break}case c instanceof k:{p=c.matchPattern(m,{skript:e,isOptional:c.isOptional});break}default:{p=c.matchPattern(m,{});break}}if(!p){if(c instanceof k&&c.isOptional)continue;return null}for(c instanceof b?r.push(...p.expressions):a.push(...p.regexes),o+=p.size;t.substring(o).startsWith(" ");)o++}return new u(o,a,r,n)}getKeywords(){return this.elements.filter(t=>t instanceof O).map(t=>t.value)}};i(rt,"GroupElement");var E=rt;var jt=class jt{constructor(t,e){this.pattern=e;s(this,"compiledPattern");this.compiledPattern=E.prototype.createPattern(this.pattern,{skript:t,patternNumber:-1})[0]}};i(jt,"Pattern");var nt=jt;var Nt=class Nt{constructor(){s(this,"syntax",new Map)}registerSyntaxElement(t){let e=t.syntaxElement().prototype.getSyntaxType();this.syntax.has(e)||this.syntax.set(e,[]),this.syntax.get(e).push(t)}getSyntaxOfType(t){var e;return(e=this.syntax.get(t))!=null?e:[]}};i(Nt,"SyntaxRegistry");var it=Nt,$t=class $t{constructor(t){s(this,"patterns");this.patterns=this.rawPatterns().map(e=>new nt(t,e))}matchPattern(t,{skript:e}){for(let[n,{compiledPattern:r}]of Object.entries(this.patterns)){if(r.getKeywords().find(o=>!t.includes(o)))continue;let a=r.matchPattern(t,{skript:e,patternNumber:parseInt(n)});if(a)return a}return null}};i($t,"SyntaxRegistration");var h=$t;var Wt=class Wt{constructor(t){this.skript=t;s(this,"isInitialized",!1);s(this,"syntaxRegistry",new it)}initialize(){if(this.isInitialized)throw new Error(`Extension '${this.name}' has already been initialized.`);this.isInitialized=!0,this.onInitialize()}};i(Wt,"SkriptExtension");var ot=Wt;var C,w=class w extends y{constructor(e,n,r,a){super(a);this.mode=e;this.changing=n;this.changeWith=r}execute(e){this.changing.change(this.mode,e,this.changeWith)}};i(w,"ModifyEffect"),s(w,"Registration",(C=class extends h{rawPatterns(){return["set %objects% to %objects%","(give|add) %objects% to %objects%","(remove|subtract) %objects% from %objects%","delete %objects%"]}syntaxElement(){return w}initialize(n,{expressions:r,patternNumber:a}){let o,p=null;switch(a){case 0:{o=r[0],p=r[1];break}case 1:case 2:{o=r[1],p=r[0];break}case 3:{o=r[0];break}default:throw new Error(`Invalid change mode ${a}`)}return new w(a,o,p,n)}},i(C,"Registration"),C));var st=w;var P,v=class v extends y{constructor(e,n){super(n);this.expression=e}execute(e){for(let n of this.expression.get(e))if(Array.isArray(n))for(let r of n)console.log(r);else console.log(n)}};i(v,"PrintEffect"),s(v,"Registration",(P=class extends h{rawPatterns(){return["print %objects% [to console]"]}syntaxElement(){return v}initialize(n,r){return new v(r.expressions[0],n)}},i(P,"Registration"),P));var at=v;var R,T=class T extends l{isSingle(){return!0}get(){return["hello world"]}getReturnType(){return String}toString(t){return"test expression"}};i(T,"TestExpression"),s(T,"Registration",(R=class extends h{rawPatterns(){return["test expr"]}syntaxElement(){return T}initialize(e,n){return new T(e)}},i(R,"Registration"),R));var pt=T;var M,B=class B extends J{postLoad(){this.trigger()}};i(B,"ScriptLoadStructure"),s(B,"Registration",(M=class extends h{rawPatterns(){return["[on] script load"]}syntaxElement(){return B}initialize(e,n){return new B(e)}},i(M,"Registration"),M));var ct=B;var At=class At extends ot{constructor(){super(...arguments);s(this,"name","core")}onInitialize(){let{syntaxRegistry:e}=this;e.registerSyntaxElement(new st.Registration(this.skript)),e.registerSyntaxElement(new ct.Registration(this.skript)),e.registerSyntaxElement(new at.Registration(this.skript)),e.registerSyntaxElement(new pt.Registration(this.skript))}};i(At,"CoreExtension");var Qt=At;var Gt=class Gt{constructor(){s(this,"entries",[]);s(this,"hasError",!1)}log(t,e){let n=new Ft(t,e);this.entries.push(n)}info(t){this.log(0,t)}warn(t){this.log(1,t)}error(t){this.log(2,t),this.hasError=!0}};i(Gt,"SimpleLogger");var Xt=Gt,Dt=class Dt{constructor(t,e){this.level=t;this.message=e}};i(Dt,"LogEntry");var Ft=Dt,_t=(n=>(n[n.Info=0]="Info",n[n.Warning=1]="Warning",n[n.Error=2]="Error",n))(_t||{});export{q as Block,S as BlockContainer,F as BooleanExpression,bt as ChangeMode,k as ChoiceElement,Qt as CoreExtension,y as Effect,l as Expression,b as ExpressionElement,$ as ExtensionRegistry,E as GroupElement,I as Integer,G as IntegerExpression,O as LiteralElement,Q as Location,X as LocationProxyLogger,Ft as LogEntry,_t as LogLevel,u as MatchPatternResult,st as ModifyEffect,D as NumberExpression,nt as Pattern,Ht as PatternElement,at as PrintEffect,tt as RegexElement,g as Result,Y as Script,ct as ScriptLoadStructure,H as Section,Zt as SectionAction,Xt as SimpleLogger,Ut as Skript,ot as SkriptExtension,Jt as SkriptParser,V as StringExpression,J as Structure,f as SyntaxElement,h as SyntaxRegistration,it as SyntaxRegistry,d as SyntaxType,pt as TestExpression,W as Type,A as Types,U as VariableExpression,qt as VariableMap,K as haltCharacters};
